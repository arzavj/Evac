<script type="text/javascript">
	$(document).ready(function(){

			//[{"question":{"id":26,"question":"testing schedule popup","asker":{"fullName":"Arzav Jain","id":1}}}
			//,{"question":{"id":31,"question":"asdfasdf","asker":{"fullName":"Arzav Jain","id":1}}}]
			var oldTabHeight = $(document).height() - $("header").height() - $("#tiny-footer").height();
			var categoryID;
			var updateListHeight = function()
			{
					var newTabHeight = $("div.tab-content").height();
					//alert(tabPaneHeight+" vs "+ defaultHeight);
					if(newTabHeight>oldTabHeight-200)
					{
						console.log("updated height");
						$(".tabs-left .nav-tabs").animate({height: (1.07*newTabHeight)+"px"}, 300);
						oldTabHeight = newTabHeight;
					}
						
			}

			var questionIsNew = function(question)
			{
					return ($("div:contains('" + question + "')").length===0);
			}
			var addNewQuestions = function(json)
			{
					var textLines = " a conversation with ";
					for(var i in json)
					{
							var obj = json[i];
							var asker = obj.question.asker;
							if(questionIsNew(obj.question.question))
							{
									var newDiv = $("<div />").css("font-weight", "bold");
									newDiv.text(obj.question.question);
									var li = newDiv.wrap("<li />").parent();
									li.css("margin-top", "1%");
									var button = $("<button class='btn' data-toggle='modal' data-target='#schedule-modal' href = '#schedule-modal'/>");
									button.click(function(){
										addQID(obj.question.id);
									});
									button.text("Schedule");
									if(<%=current_account.id%> == asker.id)
										button.attr("disabled", "disabled");
									var a = $("<a />", {href: "/profiles?id="+asker.id}).addClass("username").html(asker.fullName);
									li.append(newDiv).append(button).append(textLines).append(a);
									//$("div#tab"+categoryID+" > ul.nav").append(li).append($("<li class='divider' />"));
									li.hide().appendTo($("div#tab"+categoryID+" > ul.nav")).fadeIn("fast");
									$("<li class='divider' />").hide().appendTo($("div#tab"+categoryID+" > ul.nav")).fadeIn("fast");
									updateListHeight();
							}
					}
			}

			var questionIsOld = function(question, json)
			{
				for(var i in json)
				{
						if(json[i].question.question === question)
							return false;
				}
				return true;
			}

			var removeOldQuestions = function(json)
			{
					$("ul.nav-list > li > div").each(function(){
						if(questionIsOld($.trim($(this).text()), json))
						{
							($(this).parent()).next().fadeOut("fast"); //get rid of divider (sibling)
							$(this).parent().fadeOut("fast"); //get rid of enclosing li element
							//updateListHeight();
						}
					});
			}

			var updateCategory = function()
			{
					var JSONurl = "pages/ajaxQuestion";
					categoryID = $("li.active > a").attr("href").replace(/#tab/, "");
					$.getJSON(JSONurl, {"category": categoryID}, function(json){
								addNewQuestions(json);
								removeOldQuestions(json);
					});				
			}
			setInterval(updateCategory, 4000);
	});
</script>