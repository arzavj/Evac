<%if params["offline"]%>
<script type ="text/javascript">
	alert("It seems that that user has gone offline");
</script>
<%end%>

<%if params["schedule"].to_i == 1%> 
<script type ="text/javascript">
	alert('Your choices were sent');
	</script>
<%end%>

<%if params["sent"]%>
<script type ="text/javascript">
	alert("Your preference has been saved");
</script>
<%end%>


<script type ="text/javascript">
	function checkForm(formNumber)
	{
		var radios = document.getElementsByName("appointment" + formNumber);
		var value = true;
		for (var i = 0; i < radios.length; i++) {
			if (radios[i].type === 'radio' && radios[i].checked) {
				value = false;
				break;
			}
		}

		
		if (value)
		{
			alert("Please select one schedule");
			return false;
		}
		else
		{
			f.submit();
			return true;
		}
	}
</script>

<%= render :partial => "schedule"%>

<div class="transparent-background">
	<div class="body-wrapper">
		<div class="tabbable" id="myconversations">
			<ul class="nav nav-tabs">
		  		<li class="active"><a href="#upcoming" data-toggle="tab">Upcoming Conversations</a></li>
		  		<li><a href="#past" data-toggle="tab">Past Conversations</a></li>
			</ul>
			
			
			<div class="tab-content">
				<div class="tab-pane fade in active" id="upcoming">
					<div class="row-fluid">
						<div class="span6">
							<ul class="nav nav-list right-border">
							<!-- Questions that have been proposed to discuss -->
							<li><h3 class="SmallFont">Pending Conversations</h3></li>
							<li class="divider"></li>
							<%if @qPending.length == 0 && @qConfirmed.length==0%> 
								No upcoming conversations...
							<%end%>
						
						<%count = 0%>
						<% @qPending.each do |q| %>
						
							<li><span class="questions"><%=q.question%></span> <!-- If a pending question, it must have a answerer -->
								<%if q.answer_id != nil%>
									<%if @user.id == q.user_id%>
										<%id = q.answer_id%>
									<%else%>
										<%id = q.user_id%>
									<%end%>
									<%user = User.find(id)%>
									<%name = user.firstName + " " + user.lastName%>
									with <a class="question-username" href="/bio?id=<%=id%>"><%=name%></a>
								<%end%>
								<br />
								
							<%if q.schedules.any? && q.schedules[0].user_id != @user.id %>
								<%count = count + 1%>
								<form class="margin-bottom-5" action="/tok/AcceptSchedule" method= "get" onSubmit="return checkForm(<%=count.to_s%>);">
									<input type = "hidden" name = "qID" value = "<%= q.id %>" />
									<input type = "hidden" name = "count" value = "<%=count.to_s%>">
										<% q.schedules.each do |appointment|%> <!-- Set up form -->
										<input type="radio" name="appointment<%=count%>" value="<%=appointment.id%>" /> <div name="timeDiv"><%=appointment.appointment.strftime("%B %d, %Y %H:%M:%S UTC")%></div>
											<br />
										<%end%>
									
									<input class="btn" type="submit" value="Confirm Schedule" />
								</form>
								<button class="btn" data-toggle="modal" data-target="#schedule-modal" href = "#schedule-modal" onClick="addQID(<%=q.id%>)">
										Propose Alternate Schedule
								</button>
							<%else%>
								Waiting for conversation to be scheduled...
							<%end%>	
							</li>
							<li class="divider"></li>
							
						<%end%>
						</ul>
						</div>
						
						<!-- DIVIDE OCCURS HERE -->
						<%= render :partial => "confirmedQuestions"%>
					</div>
				</div>
				<%= render :partial => "pastConversations"%>
			</div>
	</div>
</div>

<script type ="text/javascript">
	var times = $("*[name='timeDiv']");
	var hasInnerText = (document.getElementsByTagName("body")[0].innerText != undefined) ? true : false;
	for(i = 0; i < times.length; i++){
		var appointment = times[i];
		if(!hasInnerText){
			appointment.textContent = dateFormat(new Date(appointment.textContent), 'mmmm dd yyyy hh:MM tt Z');
		}else{
			appointment.innerText = dateFormat(new Date(appointment.innerText), 'mmmm dd yyyy hh:MM tt Z');
		}
	}
	
</script>
