<%if params["fail"]%> <!-- If this alert needs to be presented to clarify to the user -->
<script type ="text/javascript">
	alert('Invalid email/password combination');
	</script>
<%end%>

<%if params["verify"]%> <!-- If this alert needs to be presented to clarify to the user -->
<script type ="text/javascript">
	alert('Please verify your email');
	</script>
<%end%>

<%if params["efail"]%>
	<script type ="text/javascript">
		alert("Invalid College E-mail Address");
	</script>
<%end%>

<%if params["exist"]%>
	<script type ="text/javascript">
		alert("This email is already being used");
	</script>
<%end%>

<%if params["pfail"]%>
	<script type ="text/javascript">
		alert("Passwords Do Not Match");
	</script>
<%end%>

<script type ="text/javascript">
	function regWithVidPopup()
	{
		$('#register-modal').modal('hide');
		$('#regWithVidPopup').click();
		return true;
	}
</script>

<%if cookies[:name]  %>
	<script>
		function checkPostForm()
		{
			var question = document.getElementsByName("question")[0];
			if (question.value == "" )
			{
				alert("Please submit a post or question");
				return false;
			}
			else
			{
				f.submit();
				return true;
			}
		}
		
		function checkScheduleForm()
		{
			if (document.getElementsByName("Slot1")[0].value == "" && document.getElementsByName("Slot2")[0].value == "" && document.getElementsByName("Slot3")[0].value == "")
			{
				alert("Please post at least one schedule");
				return false;
			}
			else
			{
				document.getElementById("submitButton").disabled = true;
				document.getElementById("offset").value = ((new Date()).getTimezoneOffset())/60;
				f.submit();
				return true;
			}
		}
		
		function addQID(qID)
		{
			var doc = document.getElementById("qScheduleID");
			doc.value= qID;
		}
		
	</script>

	<div class="modal hide fade" id="schedule-modal">
		<div class="modal-header">
			<button class="close" data-dismiss="modal">&times;</button>
			<h3>Times that work for you:</h3>
		</div>
		<div class="modal-body">
			<form class="well" action="/tok/Schedule" name ="input" method= "GET" onSubmit="return checkScheduleForm();">
			
				<%(1..3).each do |i| %>
			
					<script text="text/javascript">
						$(function() {
						  $( "#<%=i%>" ).datetimepicker({minDate: 0});
						});
					</script>
			
					<input class="search-query" style="cursor: pointer;" id="<%=i%>" name="Slot<%=i%>" type="text" size="25" readonly="readonly" placeholder="Click here to select times..."/>
			
					<p>
				<%end%>
			
				<input type="hidden" id="offset" name="timeOffset" value="" />
				<input type="hidden" id="qScheduleID" name="qID" value="" />
				<input class="btn btn-inverse" type="submit" id= "submitButton" value= "Submit"/>
			</form>	
		</div>
	</div>


	<div class="navbar">
	  	<div class="navbar-inner">		
	    	<div class="container">		
				<span class="brand">Spark a Conversation</span>
				<form name="input" action="/pages/submitQuestion?method=post" method="post" class="navbar-search pull-left" onSubmit="return checkPostForm();">
					<ul>
						<!-- Creates a form to submit a question with a given category -->
						<li class="divider-vertical inline"></li>
						<h4 class="inline">Category:</h4>
						<select name="category" style="width:154px;">
							<%(0..@categories.length-1).each do |i|%>
	  							<option value="<%=(i+1)%>"><%=@categories[i]%></option>
							<%end%>
						</select>				
						<li class="divider-vertical inline"></li>
						<li class="inline"><input type="text" name="question" class="search-query" placeholder="Post a conversation topic"></li>	
						<li class="divider-vertical inline"></li>
						<!--
						<li class="inline"><input class="btn btn-info" type="submit" name="sType" value="Post and Enter Room" /></li> 
						 -->
						 <!--For entering chat room-->
						<li class="inline" style="position: relative; bottom: 3px;"><input class="btn btn-info" type="submit" name="sType" value="Submit Post" /></li> <!--For just posting-->
					</ul>
				</form>
			</div>
		</div>
	</div>
	

		<div class="transparent-background">
		<div class="body-wrapper">
			<center><h1>Browse Interesting Posts</h1></center>
			<div class="row-fluid">
				<div class="span12">
					<div class="tabbable tabs-left">
			  			<ul class="nav nav-tabs">
							<!-- Creates the banner on the left for the user to select a category -->
							<%(0..@categories.length-1).each do |i|%>
								<%questions = Question.where("category = ? AND was_answered = ? AND answer_id IS NULL", i+1, false)%>
								<%tabStr = @categories[i] + " (" + questions.length.to_s + ")"%>
								<%if i==0 %>
			    					<li class="active"><a href="#tab<%=i%>" data-toggle="tab"><%=tabStr%></a></li>
								<%else%>
			    					<li><a href="#tab<%=i%>" data-toggle="tab"><%=tabStr%></a></li>
								<%end%>
							<%end%>
			  			</ul>
			  			<div class="tab-content">
						<!-- Preloads the top 5 questions for each category -->
						<%(0..@categories.length-1).each do |i|%>
							<%if i == 0%>
								<div class="tab-pane fade in active" id="tab<%=i%>">
							<%else%>
								<div class="tab-pane fade in" id="tab<%=i%>">
							<%end%>
								<ul class="nav nav-list">
									<!-- Creates the query to the database based on category, if the question was answered, and that nobody has choosen to answer -->
  									<%questions = Question.where("category = ? AND was_answered = ? AND answer_id IS NULL", i+1, false)%>
									<%counter = 0%>
									<%if questions.length==0 %>
										<li style="margin-top:10px;">No posts currently in this category</li>
									<%end%>
									<%questions.each do |q|%>
											<% u = q.user %>
											<% name = u.firstName +  " " + u.lastName %>
					    					<li style="margin-top:1%;"><b><%= q.question%></b><br />
											<% if q.in_session %> <!--Check if user is waiting -->
												<% str = "Answer" %>
											<% else %>
												<% str = "Schedule Appointment" %>
												<%if u.id != @user.id%>
													<button class="btn" data-toggle="modal" data-target="#schedule-modal" href = "#schedule-modal" onClick="addQID(<%=q.id%>)">
															Schedule
													</button> 
												<%else%>
													<button class="btn" disabled="disabled" data-toggle="modal" data-target="#schedule-modal" href = "#schedule-modal" onClick="addQID(<%=q.id%>)">
															Schedule
													</button>
												<%end%>
												a conversation with <a id="username" href = "/bio?id=<%=u.id%>" ><%= name %></a>
											<% end %>
											
											</li>
											<li class="divider"></li>
											<%counter = counter + 1%>
									<%end%>	
								</ul>
							</div>
						<%end%>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<%else%> <!-- If not logged in-->
	<div class="transparent-background">
	<div class="body-wrapper">
		<div id="home-row" class="row-fluid">
		<div class="span6">
			<div id="lowHeaderPos">
				<div class="fredoka" id="home-header">A community for <br />interesting conversations!</div>
			</div>
			<div id="introLines">
				<p class="SmallFont">Connect with amazing people and have insightful<br /> video-chat conversations about topics you're passionate<br /> about</p>
			</div>
			<div class="modal hide fade" id="facebook-modal">
				<div class="modal-header">
					<button class="close" data-dismiss="modal">&times;</button>
					<h3>Register With Facebook</h3>
				</div>
				<div class="modal-body">
					<!-- {'name':'school', 'description':'College',  'type':'text'} IS IF I WANTED THE SCHOOL TYPED-->

					<iframe src="https://www.facebook.com/plugins/registration.php?
			             client_id=448981068445455&
			             redirect_uri=http://vidactica.com/fb_registration/RegisterUser&
			             fields=[
							{'name':'name', 'view':'prefilled'},
							{'name':'first_name'},
							{'name':'last_name'},
							{'name':'email', 'description':'Email',  'type':'text'},
							{'name':'password'}
							]"
			        scrolling="auto"
			        frameborder="no"
			        style="border:none"
			        allowTransparency="true"
			        width="100%"
			        height="330">
					</iframe> 
				</div>
			</div>
			<div class="fb-login-button">
				<a data-toggle="modal" data-target="#facebook-modal" href = "#facebook-modal">
					<%= image_tag("signup-facebook-md.png", :width => "250") %>
				</a>
			</div>
			<div class="modal hide fade" id="register-modal">
				<div class="modal-header">
					<button class="close" data-dismiss="modal">&times;</button>
					<h3>Register With Vidactica</h3>
				</div>
				<div class="modal-body">
					<form class="well form-horizontal" action="/fb_registration/SaveUser" method="post">
						<fieldset>
							<div class="control-group">
								<label class="control-label">First Name: </label>
								<div class="controls">
									<input type="text" value= "<%=params["fname"]%>" name="fname" />
								</div>
							</div>
							
							<div class="control-group">
								<label class="control-label">Last Name: </label>
								<div class="controls">
									<input type="text" value= "<%=params["lname"]%>" name="lname" />
								</div>
							</div>

							<div class="control-group">
								<label class="control-label">Email:</label>
								<div class="controls">
									<input class="input-xlarge" type="text" value= "<%=params["email"]%>" name="email" />
								</div>
							</div>
							
							<div class="control-group">
								<label class="control-label">Vidactica Password:</label>
								<div class="controls">
									<input class="input-xlarge" type="password" name="password" />
								</div>
							</div>
							<div class="control-group">
								<label class="control-label">Re-Enter Password:</label>
								<div class="controls">
									<input class="input-xlarge" type="password" name="passwordAgain" />
								</div>
							</div>
							<div class="control-group">
								<div class="controls">
									<input class="btn btn-inverse" type="submit" value="Submit"/>	
								</div>
							</div>
							
						</fieldset>
					</form>
				</div>
			</div>
			<div id="email-signup">
				<a data-toggle="modal" data-target="#register-modal" href = "#register-modal">
					Don't have a Facebook account? Sign Up with Email instead
				</a>
			</div>
			<div class="modal hide fade" id="regWithVid-modal">
				<div class="modal-body">
					<button class="close" data-dismiss="modal">&times;</button>
				</div>
			</div>
			<a data-toggle="modal" data-target="#regWithVid-modal" href = "#regWithVid-modal" style="display:none;">
				RegWithVid
			</a>
			<%if params["email"]%> <!-- If this alert needs to be presented to clarify to the user -->
			<script type ="text/javascript">
				$('#regWithVid-modal').modal('show');
			</script>
			<%end%>
		</div>
		<div class="span6" style="margin-left:0px;">
			<div class="slider-wrapper theme-default">
				<div class="ribbon"></div>
				<div id="slider" class="nivoSlider round">
					<img src="images/Animation1.png" alt="" />
					<img src="images/Animation2.png" alt="" />
					<img src="images/Animation3.png" alt="" />
				</div>
			</div>
		</div>
		</div>
	<div class="border-padding"></div>
	</div>
	</div>
	<div class="row-fluid">
		<div class="span12"><%= render 'layouts/footer' %></div>		   	  		
	</div>
	<%end%>